{
  "name": "Python Stable Env",
  "image": "mcr.microsoft.com/devcontainers/python:1-3.11-bookworm",

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-toolsai.jupyter",
        "ms-toolsai.jupyter-keymap",
        "ms-toolsai.jupyter-renderers",
        "ms-toolsai.vscode-jupyter-cell-tags",
        "ms-toolsai.vscode-jupyter-slideshow",
        "ms-python.black-formatter",
        "ms-python.isort",
        "formulahendry.code-runner",
        "esbenp.prettier-vscode",
        "monokai.theme-monokai-pro-vscode",
        "pkief.material-icon-theme"
      ],
      "settings": {
        "python.defaultInterpreterPath": "${workspaceFolder}/.venv/bin/python",
        "python.analysis.typeCheckingMode": "basic",
        "python.terminal.activateEnvironment": true,
        "[python]": { "editor.defaultFormatter": "ms-python.black-formatter" },
        "code-runner.executorMap": { "python": "${workspaceFolder}/.venv/bin/python -u" },
        "code-runner.runInTerminal": true,
        "code-runner.fileDirectoryAsCwd": true,
        "code-runner.ignoreSelection": true,
        "code-runner.saveFileBeforeRun": true
      }
    }
  },

  "containerEnv": { "PIP_CACHE_DIR": "/home/vscode/.cache/pip" },

  "onCreateCommand": "bash -lc 'set -e; PY=$(command -v python || command -v python3); [ -d .venv ] || \"$PY\" -m venv .venv'",

  "updateContentCommand": "bash -lc 'set -e; REQ=\"\"; [ -f requirements.lock.txt ] && REQ=requirements.lock.txt || { [ -f requirements.txt ] && REQ=requirements.txt; }; PY=$(command -v python || command -v python3); [ -d .venv ] || \"$PY\" -m venv .venv; VENV_PY=.venv/bin/python; [ -x \"$VENV_PY\" ] || VENV_PY=.venv/bin/python3; NH=\"\"; [ -n \"$REQ\" ] && NH=$(sha256sum \"$REQ\" | cut -d\" \" -f1) || true; OH=$(cat .venv/.req.hash 2>/dev/null || true); if [ \"$NH\" != \"$OH\" ]; then \"$VENV_PY\" -m pip install -U pip setuptools wheel; [ -n \"$REQ\" ] && \"$VENV_PY\" -m pip install --prefer-binary -r \"$REQ\"; echo \"$NH\" > .venv/.req.hash; fi'",

  "postCreateCommand": "bash -lc 'set -e; VENV_PY=.venv/bin/python; [ -x \"$VENV_PY\" ] || VENV_PY=.venv/bin/python3; \"$VENV_PY\" -m pip install -q ipykernel; \"$VENV_PY\" -m ipykernel install --user --name=${PWD##*/}-venv --display-name \"Python (.venv)\"'",

  "postStartCommand": "bash -lc 'if [ -x .venv/bin/python ]; then echo Using: $(.venv/bin/python -c \"import sys;print(sys.executable)\"); .venv/bin/python -V; elif [ -x .venv/bin/python3 ]; then echo Using: $(.venv/bin/python3 -c \"import sys;print(sys.executable)\"); .venv/bin/python3 -V; fi'",

  "mounts": [
    "source=pip-cache,target=/home/vscode/.cache/pip,type=volume"
  ],

  "remoteUser": "vscode"
}